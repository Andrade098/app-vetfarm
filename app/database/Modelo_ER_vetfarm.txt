erDiagram
    USUARIO {
        int id PK
        string nome
        string sobrenome
        string email UK
        string senha_hash
        string cpf UK
        string telefone
        date data_nascimento
        datetime created_at
        datetime updated_at
    }

    FARMACIA_PARCEIRA {
        int id PK
        string nome
        text descricao
        string email UK
        string senha_hash
        string telefone
        string endereco
        string bairro
        string cidade
        string estado
        string cep
        boolean ativa
        datetime created_at
        datetime updated_at
    }

    IMAGEM_FARMACIA {
        int id PK
        int farmacia_id FK
        string url_imagem
        int ordem
        datetime created_at
    }

    ENDERECO {
        int id PK
        int usuario_id FK
        string apelido
        string logradouro
        string numero
        string complemento
        string bairro
        string cidade
        string estado
        string cep
        boolean principal
        datetime created_at
        datetime updated_at
    }

    CATEGORIA_ANIMAL {
        int id PK
        string nome UK
        text descricao
        boolean ativa
    }

    CATEGORIA_PRODUTO {
        int id PK
        string nome UK
        text descricao
        boolean ativa
    }

    PRODUTO {
        int id PK
        int farmacia_id FK
        int categoria_animal_id FK
        int categoria_produto_id FK
        string nome
        text descricao
        decimal preco
        int estoque
        boolean ativo
        datetime created_at
        datetime updated_at
    }

    IMAGEM_PRODUTO {
        int id PK
        int produto_id FK
        string url_imagem
        int ordem
        datetime created_at
    }

    FAVORITO {
        int id PK
        int usuario_id FK
        int produto_id FK
        datetime created_at
    }

    PEDIDO {
        int id PK
        int usuario_id FK
        int endereco_id FK
        string numero_pedido UK
        string status
        decimal valor_total
        string forma_pagamento
        string codigo_rastreio
        date data_prevista_entrega
        string cpf_nota_fiscal
        string email_nota_fiscal
        datetime created_at
        datetime updated_at
    }

    ITEM_PEDIDO {
        int id PK
        int pedido_id FK
        int produto_id FK
        int quantidade
        decimal preco_unitario
        decimal subtotal
    }

    RASTREAMENTO_PEDIDO {
        int id PK
        int pedido_id FK
        string status
        date data
        time hora
        string descricao
        string localizacao
        datetime created_at
    }

    PROGRAMA_FIDELIDADE {
        int id PK
        int usuario_id FK
        int pontos_atuais
        int pontos_totais
        string nivel
        int consultas_gratis
        date data_expiracao
        datetime updated_at
    }

    HISTORICO_PONTOS {
        int id PK
        int usuario_id FK
        int pedido_id FK
        date data
        string descricao
        decimal valor_compra
        int pontos
        string tipo
        datetime created_at
    }

    NOTIFICACAO {
        int id PK
        int usuario_id FK
        string titulo
        string mensagem
        time horario
        boolean lida
        datetime created_at
    }

    CARRINHO {
        int id PK
        int usuario_id FK
        int produto_id FK
        int quantidade
        datetime created_at
        datetime updated_at
    }

    %% Relacionamentos
    USUARIO ||--o{ ENDERECO : possui
    USUARIO ||--o{ FAVORITO : tem
    USUARIO ||--o{ PEDIDO : faz
    USUARIO ||--o{ NOTIFICACAO : recebe
    USUARIO ||--o{ CARRINHO : tem
    USUARIO ||--|| PROGRAMA_FIDELIDADE : participa
    USUARIO ||--o{ HISTORICO_PONTOS : acumula

    FARMACIA_PARCEIRA ||--o{ PRODUTO : vende
    FARMACIA_PARCEIRA ||--o{ IMAGEM_FARMACIA : possui

    CATEGORIA_ANIMAL ||--o{ PRODUTO : categoriza
    CATEGORIA_PRODUTO ||--o{ PRODUTO : classifica

    PRODUTO ||--o{ IMAGEM_PRODUTO : possui
    PRODUTO ||--o{ FAVORITO : favoritado_em
    PRODUTO ||--o{ ITEM_PEDIDO : composto_em
    PRODUTO ||--o{ CARRINHO : adicionado_em

    PEDIDO ||--o{ ITEM_PEDIDO : contem
    PEDIDO ||--o{ RASTREAMENTO_PEDIDO : rastreado_por
    PEDIDO ||--o{ HISTORICO_PONTOS : gera
    ENDERECO ||--o{ PEDIDO : usado_em